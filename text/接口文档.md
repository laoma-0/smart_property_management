# 智能物业管理系统接口文档

## 1. 概述

本文档定义了智能物业管理系统的RESTful API接口规范，包括用户管理、小区管理、楼栋管理、房间管理、报修管理、费用管理和公告管理等功能模块。

### 1.1 文档版本

| 版本号 | 修改日期   | 修改人 | 修改内容                           | 审核人 |
| ------ | ---------- | ------ | ---------------------------------- | ------ |
| v1.0   | 2023-06-01 | 系统   | 初始版本                           | Ma Bin |
| v1.1   | 2023-06-02 | 系统   | 增加错误处理、频率限制和版本控制说明 | Ma Bin |

### 1.2 接口约定

- **请求和响应格式**：JSON
- **字符编码**：UTF-8
- **认证方式**：JWT Token
- **请求方法**：遵循RESTful API设计规范
- **URL格式**：`http(s)://服务器地址[:端口]/api/{模块名}/{接口名}`

### 1.3 统一响应格式

所有接口均返回统一格式的JSON数据：

```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": "2023-06-01T12:00:00Z"
}
```

#### 1.3.1 响应参数说明

| 参数名    | 类型   | 必填 | 说明       |
| --------- | ------ | ---- | ---------- |
| code      | int    | 是   | 响应状态码 |
| message   | string | 是   | 响应消息   |
| data      | object | 否   | 响应数据   |
| timestamp | string | 是   | 响应时间戳 |

#### 1.3.2 响应状态码

| 状态码 | 说明         | 描述                  |
| ------ | ------------ | --------------------- |
| 200    | 请求成功     | 接口调用成功          |
| 400    | 请求参数错误 | 请求参数不合法        |
| 401    | 未认证       | 用户未登录或Token过期 |
| 403    | 权限不足     | 用户无权限访问该接口  |
| 404    | 资源不存在   | 请求的资源不存在      |
| 429    | 请求过于频繁 | 超出接口调用频率限制  |
| 500    | 服务器错误   | 服务器内部错误        |

### 1.4 分页参数规范

对于列表查询接口，统一使用以下分页参数：

| 参数名   | 类型 | 必填 | 默认值 | 说明       |
| -------- | ---- | ---- | ------ | ---------- |
| page     | int  | 否   | 1      | 当前页码   |
| pageSize | int  | 否   | 10     | 每页记录数 |

### 1.5 公共请求头

| 请求头字段    | 类型   | 必填 | 说明             |
| ------------- | ------ | ---- | ---------------- |
| Authorization | string | 是   | JWT认证Token     |
| Content-Type  | string | 是   | application/json |

### 1.6 错误处理机制

系统采用统一的错误处理机制，当发生错误时会返回标准错误响应格式。

#### 1.6.1 业务错误处理

业务相关的错误通过响应中的 `code` 和 `message` 字段进行标识和描述：

```json
{
  "code": 400,
  "message": "用户名或密码错误",
  "data": null,
  "timestamp": "2023-06-01T12:00:00Z"
}
```

#### 1.6.2 系统错误处理

系统级别的错误会记录在日志中，并返回通用错误信息给客户端：

```json
{
  "code": 500,
  "message": "系统内部错误",
  "data": null,
  "timestamp": "2023-06-01T12:00:00Z"
}
```

#### 1.6.3 参数验证错误

对于参数验证失败的情况，会返回详细的错误信息：

```json
{
  "code": 400,
  "message": "参数验证失败",
  "data": {
    "username": "用户名不能为空",
    "password": "密码长度不能少于6位"
  },
  "timestamp": "2023-06-01T12:00:00Z"
}
```

### 1.7 接口调用频率限制

为防止接口被恶意调用或过度使用，系统对部分敏感接口实施频率限制。

#### 1.7.1 限制策略

| 接口类型     | 限制策略                    | 说明                         |
| ------------ | --------------------------- | ---------------------------- |
| 登录接口     | 每分钟最多10次              | 防止暴力破解                 |
| 查询接口     | 每分钟最多100次             | 防止数据爬取                 |
| 写入接口     | 每分钟最多50次              | 防止恶意数据提交             |
| 文件上传接口 | 每小时最多10次，每次≤10MB   | 防止服务器资源被过度占用     |

#### 1.7.2 超限响应

当接口调用频率超出限制时，系统将返回429状态码：

```json
{
  "code": 429,
  "message": "请求过于频繁，请稍后再试",
  "data": null,
  "timestamp": "2023-06-01T12:00:00Z"
}
```

### 1.8 接口版本控制策略

为保证接口的向后兼容性，系统采用URL版本控制策略。

#### 1.8.1 版本标识

接口版本通过URL中的版本号标识，当前版本为v1：

```
http(s)://服务器地址[:端口]/api/v1/{模块名}/{接口名}
```

#### 1.8.2 版本兼容性

- 向后兼容：新版本接口保证对旧版本客户端的兼容性
- 非兼容性更新：对于不兼容的更新，将发布新版本接口
- 版本废弃：废弃的版本将提前30天通知，并保留6个月的过渡期

#### 1.8.3 版本升级流程

1. 新功能开发在当前版本基础上进行
2. 不兼容更新需发布新版本接口
3. 旧版本接口在新版本发布后进入维护期
4. 维护期结束后停止服务并提前通知用户

## 2. 用户管理接口

### 2.1 用户登录

**接口地址**: `POST /api/auth/login`

**接口描述**: 用户登录认证，获取访问Token

**请求参数**:

| 参数名   | 类型   | 必填 | 说明   |
| -------- | ------ | ---- | ------ |
| username | string | 是   | 用户名 |
| password | string | 是   | 密码   |

**请求示例**:
```json
{
  "username": "admin",
  "password": "123456"
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "username": "admin",
      "realName": "系统管理员",
      "phone": "13800138000",
      "email": "admin@example.com",
      "status": 1
    },
    "expiresIn": 7200
  },
  "timestamp": "2023-06-01T12:00:00Z"
}
```

#### 2.1.1 响应参数说明

| 参数名        | 类型   | 必填 | 说明                 |
| ------------- | ------ | ---- | -------------------- |
| token         | string | 是   | JWT访问令牌          |
| user          | object | 是   | 用户信息             |
| user.id       | int    | 是   | 用户ID               |
| user.username | string | 是   | 用户名               |
| user.realName | string | 是   | 真实姓名             |
| user.phone    | string | 是   | 联系电话             |
| user.email    | string | 是   | 邮箱                 |
| user.status   | int    | 是   | 状态：0-禁用，1-正常 |
| expiresIn     | int    | 是   | Token过期时间（秒）  |

### 2.2 获取当前用户信息

**接口地址**: `GET /api/user/info`

**接口描述**: 获取当前登录用户的基本信息

**请求参数**: 无

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "username": "admin",
    "realName": "系统管理员",
    "phone": "13800138000",
    "email": "admin@example.com",
    "status": 1,
    "role": {
      "id": 1,
      "roleName": "admin",
      "roleDesc": "系统管理员"
    }
  },
  "timestamp": "2023-06-01T12:00:00Z"
}
```

#### 2.2.1 响应参数说明

| 参数名        | 类型   | 必填 | 说明                 |
| ------------- | ------ | ---- | -------------------- |
| id            | int    | 是   | 用户ID               |
| username      | string | 是   | 用户名               |
| realName      | string | 是   | 真实姓名             |
| phone         | string | 是   | 联系电话             |
| email         | string | 是   | 邮箱                 |
| status        | int    | 是   | 状态：0-禁用，1-正常 |
| role          | object | 是   | 角色信息             |
| role.id       | int    | 是   | 角色ID               |
| role.roleName | string | 是   | 角色名称             |
| role.roleDesc | string | 是   | 角色描述             |

### 2.3 用户列表

**接口地址**: `GET /api/user/list`

**接口描述**: 获取用户列表

**请求参数**:

| 参数名   | 类型   | 必填 | 说明     |
| -------- | ------ | ---- | -------- |
| page     | int    | 否   | 页码     |
| pageSize | int    | 否   | 每页数量 |
| username | string | 否   | 用户名   |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "username": "admin",
        "realName": "系统管理员",
        "phone": "13800138000",
        "email": "admin@example.com",
        "status": 1,
        "createTime": "2023-06-01 09:00:00"
      }
    ],
    "total": 1
  }
}
```

### 2.4 创建用户

**接口地址**: `POST /api/user/create`

**请求参数**:
```json
{
  "username": "newuser",
  "password": "123456",
  "realName": "新用户",
  "phone": "13800138001",
  "email": "newuser@example.com",
  "status": 1
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "id": 2
  }
}
```

### 2.5 更新用户

**接口地址**: `POST /api/user/update`

**请求参数**:
```json
{
  "id": 2,
  "realName": "更新用户",
  "phone": "13800138002",
  "email": "update@example.com",
  "status": 1
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

### 2.6 删除用户

**接口地址**: `POST /api/user/delete/{id}`

**请求参数**: 路径参数 id

**响应示例**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

## 3. 小区管理接口

### 3.1 小区列表

**接口地址**: `GET /api/community/list`

**请求参数**:

| 参数名   | 类型   | 必填 | 说明     |
| -------- | ------ | ---- | -------- |
| page     | int    | 否   | 页码     |
| pageSize | int    | 否   | 每页数量 |
| name     | string | 否   | 小区名称 |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "name": "阳光花园",
        "address": "北京市海淀区阳光路88号",
        "developer": "阳光地产",
        "propertyCompany": "智慧物业有限公司",
        "buildYear": 2015,
        "totalBuildings": 10,
        "totalHouses": 500,
        "description": "阳光花园小区环境优美，配套设施齐全",
        "createTime": "2023-06-01 09:00:00"
      }
    ],
    "total": 1
  }
}
```

### 3.2 创建小区

**接口地址**: `POST /api/community/create`

**请求参数**:
```json
{
  "name": "新小区",
  "address": "新小区地址",
  "developer": "开发商",
  "propertyCompany": "物业公司",
  "buildYear": 2020,
  "totalBuildings": 5,
  "totalHouses": 200,
  "description": "新小区描述"
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "id": 3
  },
  "timestamp": "2023-06-01T12:00:00Z"
}
```

### 3.3 更新小区

**接口地址**: `POST /api/community/update`

**请求参数**:
```json
{
  "id": 3,
  "name": "更新小区",
  "address": "更新地址",
  "developer": "更新开发商",
  "propertyCompany": "更新物业公司",
  "buildYear": 2021,
  "totalBuildings": 6,
  "totalHouses": 250,
  "description": "更新描述"
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

### 3.4 删除小区

**接口地址**: `POST /api/community/delete/{id}`

**请求参数**: 路径参数 id

**响应示例**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

## 4. 楼栋管理接口

### 4.1 楼栋列表

**接口地址**: `GET /api/building/list`

**请求参数**:

| 参数名      | 类型   | 必填 | 说明     |
| ----------- | ------ | ---- | -------- |
| page        | int    | 否   | 页码     |
| pageSize    | int    | 否   | 每页数量 |
| communityId | int    | 否   | 小区ID   |
| buildingNo  | string | 否   | 楼栋编号 |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "communityId": 1,
        "buildingNo": "1号楼",
        "totalFloors": 18,
        "unitCount": 2,
        "createTime": "2023-06-01 09:00:00",
        "community": {
          "id": 1,
          "name": "阳光花园"
        }
      }
    ],
    "total": 1
  }
}
```

### 4.2 创建楼栋

**接口地址**: `POST /api/building/create`

**请求参数**:
```json
{
  "communityId": 1,
  "buildingNo": "3号楼",
  "totalFloors": 20,
  "unitCount": 3
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "id": 5
  }
}
```

### 4.3 更新楼栋

**接口地址**: `POST /api/building/update`

**请求参数**:
```json
{
  "id": 5,
  "communityId": 1,
  "buildingNo": "3号楼",
  "totalFloors": 22,
  "unitCount": 3
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

### 4.4 删除楼栋

**接口地址**: `POST /api/building/delete/{id}`

**请求参数**: 路径参数 id

**响应示例**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

## 5. 房间管理接口

### 5.1 房间列表

**接口地址**: `GET /api/room/list`

**请求参数**:

| 参数名     | 类型   | 必填 | 说明     |
| ---------- | ------ | ---- | -------- |
| page       | int    | 否   | 页码     |
| pageSize   | int    | 否   | 每页数量 |
| buildingId | int    | 否   | 楼栋ID   |
| unitNo     | string | 否   | 单元号   |
| roomNo     | string | 否   | 房间号   |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "buildingId": 1,
        "unitNo": "1单元",
        "floorNo": 5,
        "roomNo": "101",
        "area": 89.50,
        "roomType": "两室一厅",
        "ownerId": 3,
        "status": 1,
        "createTime": "2023-06-01 09:00:00",
        "building": {
          "id": 1,
          "buildingNo": "1号楼"
        },
        "owner": {
          "id": 3,
          "realName": "张三"
        }
      }
    ],
    "total": 1
  }
}
```

### 5.2 创建房间

**接口地址**: `POST /api/room/create`

**请求参数**:
```json
{
  "buildingId": 1,
  "unitNo": "2单元",
  "floorNo": 6,
  "roomNo": "201",
  "area": 78.80,
  "roomType": "两室一厅",
  "ownerId": null,
  "status": 0
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "id": 6
  }
}
```

### 5.3 更新房间

**接口地址**: `POST /api/room/update`

**请求参数**:
```json
{
  "id": 6,
  "buildingId": 1,
  "unitNo": "2单元",
  "floorNo": 6,
  "roomNo": "201",
  "area": 80.00,
  "roomType": "两室一厅",
  "ownerId": 4,
  "status": 1
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

### 5.4 删除房间

**接口地址**: `POST /api/room/delete/{id}`

**请求参数**: 路径参数 id

**响应示例**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

## 6. 报修管理接口

### 6.1 报修列表

**接口地址**: `GET /api/repair/list`

**请求参数**:

| 参数名   | 类型 | 必填 | 说明     |
| -------- | ---- | ---- | -------- |
| page     | int  | 否   | 页码     |
| pageSize | int  | 否   | 每页数量 |
| roomId   | int  | 否   | 房间ID   |
| status   | int  | 否   | 状态     |
| userId   | int  | 否   | 报修人ID |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "roomId": 1,
        "userId": 3,
        "repairType": "水电维修",
        "description": "厨房水龙头漏水",
        "status": 2,
        "handlerId": 2,
        "handleTime": "2023-06-15 14:30:00",
        "handleNotes": "已更换新的水龙头",
        "createTime": "2023-06-10 09:00:00",
        "room": {
          "id": 1,
          "roomNo": "101"
        },
        "user": {
          "id": 3,
          "realName": "张三"
        },
        "handler": {
          "id": 2,
          "realName": "物业经理"
        }
      }
    ],
    "total": 1
  }
}
```

### 6.2 创建报修

**接口地址**: `POST /api/repair/create`

**请求参数**:
```json
{
  "roomId": 2,
  "userId": 4,
  "repairType": "家电维修",
  "description": "空调不制冷"
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "报修成功",
  "data": {
    "id": 4
  }
}
```

### 6.3 更新报修状态

**接口地址**: `POST /api/repair/update`

**请求参数**:
```json
{
  "id": 4,
  "status": 1,
  "handlerId": 2,
  "handleNotes": "正在处理中"
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

### 6.4 删除报修

**接口地址**: `POST /api/repair/delete/{id}`

**请求参数**: 路径参数 id

**响应示例**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

## 7. 费用类型管理接口

### 7.1 费用类型列表

**接口地址**: `GET /api/feeType/list`

**请求参数**:

| 参数名   | 类型   | 必填 | 说明     |
| -------- | ------ | ---- | -------- |
| page     | int    | 否   | 页码     |
| pageSize | int    | 否   | 每页数量 |
| name     | string | 否   | 费用名称 |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "name": "物业费",
        "description": "物业管理服务费",
        "unitPrice": 1.80,
        "unit": "元/平方米/月",
        "createTime": "2023-06-01 09:00:00"
      }
    ],
    "total": 1
  }
}
```

### 7.2 创建费用类型

**接口地址**: `POST /api/feeType/create`

**请求参数**:
```json
{
  "name": "垃圾处理费",
  "description": "生活垃圾处理费用",
  "unitPrice": 10.00,
  "unit": "元/月"
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "id": 6
  }
}
```

### 7.3 更新费用类型

**接口地址**: `POST /api/feeType/update`

**请求参数**:
```json
{
  "id": 6,
  "name": "垃圾处理费",
  "description": "生活垃圾处理费用",
  "unitPrice": 12.00,
  "unit": "元/月"
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

### 7.4 删除费用类型

**接口地址**: `POST /api/feeType/delete/{id}`

**请求参数**: 路径参数 id

**响应示例**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

## 8. 缴费记录管理接口

### 8.1 缴费记录列表

**接口地址**: `GET /api/payment/list`

**请求参数**:

| 参数名    | 类型 | 必填 | 说明       |
| --------- | ---- | ---- | ---------- |
| page      | int  | 否   | 页码       |
| pageSize  | int  | 否   | 每页数量   |
| roomId    | int  | 否   | 房间ID     |
| userId    | int  | 否   | 缴费人ID   |
| feeTypeId | int  | 否   | 费用类型ID |
| status    | int  | 否   | 状态       |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "roomId": 1,
        "userId": 3,
        "feeTypeId": 1,
        "amount": 161.10,
        "paymentNo": "20230601001",
        "paymentTime": "2023-06-01 09:30:00",
        "paymentMethod": "微信支付",
        "status": 1,
        "createTime": "2023-06-01 09:00:00",
        "room": {
          "id": 1,
          "roomNo": "101"
        },
        "user": {
          "id": 3,
          "realName": "张三"
        },
        "feeType": {
          "id": 1,
          "name": "物业费"
        }
      }
    ],
    "total": 1
  }
}
```

### 8.2 创建缴费记录

**接口地址**: `POST /api/payment/create`

**请求参数**:
```json
{
  "roomId": 2,
  "userId": 4,
  "feeTypeId": 1,
  "amount": 198.36,
  "paymentNo": "20230601003",
  "paymentMethod": "支付宝",
  "status": 1
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "缴费成功",
  "data": {
    "id": 5
  }
}
```

### 8.3 更新缴费记录

**接口地址**: `POST /api/payment/update`

**请求参数**:
```json
{
  "id": 5,
  "paymentTime": "2023-06-01 10:00:00",
  "status": 1
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

### 8.4 删除缴费记录

**接口地址**: `POST /api/payment/delete/{id}`

**请求参数**: 路径参数 id

**响应示例**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

## 9. 公告管理接口

### 9.1 公告列表

**接口地址**: `GET /api/notice/list`

**请求参数**:

| 参数名      | 类型   | 必填 | 说明     |
| ----------- | ------ | ---- | -------- |
| page        | int    | 否   | 页码     |
| pageSize    | int    | 否   | 每页数量 |
| title       | string | 否   | 公告标题 |
| communityId | int    | 否   | 小区ID   |
| isTop       | int    | 否   | 是否置顶 |
| status      | int    | 否   | 状态     |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "title": "小区停电通知",
        "content": "因线路检修，本小区将于2023年6月20日上午8:00-12:00停电，请各位业主提前做好准备。",
        "publisherId": 2,
        "communityId": 1,
        "isTop": 1,
        "status": 1,
        "publishTime": "2023-06-10 08:30:00",
        "createTime": "2023-06-10 08:00:00",
        "publisher": {
          "id": 2,
          "realName": "物业经理"
        },
        "community": {
          "id": 1,
          "name": "阳光花园"
        }
      }
    ],
    "total": 1
  }
}
```

### 9.2 创建公告

**接口地址**: `POST /api/notice/create`

**请求参数**:
```json
{
  "title": "新公告",
  "content": "这是新公告的内容",
  "publisherId": 2,
  "communityId": 1,
  "isTop": 0,
  "status": 1
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "发布公告成功",
  "data": {
    "id": 4
  }
}
```

### 9.3 更新公告

**接口地址**: `POST /api/notice/update`

**请求参数**:
```json
{
  "id": 4,
  "title": "更新公告",
  "content": "这是更新后的公告内容",
  "isTop": 1,
  "status": 1
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

### 9.4 删除公告

**接口地址**: `POST /api/notice/delete/{id}`

**请求参数**: 路径参数 id

**响应示例**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

## 10. 数据库设计

### 10.1 创建数据库
```sql
CREATE DATABASE IF NOT EXISTS db_smart_property_management CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 10.2 使用数据库
```sql
USE db_smart_property_management;
```

### 10.3 创建角色表
```sql
CREATE TABLE IF NOT EXISTS tb_role (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '角色ID',
    role_name VARCHAR(50) NOT NULL COMMENT '角色名称',
    role_desc VARCHAR(200) COMMENT '角色描述',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_role_name (role_name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='角色表';
```

### 10.4 创建用户表
```sql
CREATE TABLE IF NOT EXISTS tb_user (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '用户ID',
    username VARCHAR(50) NOT NULL COMMENT '用户名',
    password VARCHAR(100) NOT NULL COMMENT '密码',
    real_name VARCHAR(50) COMMENT '真实姓名',
    phone VARCHAR(20) COMMENT '联系电话',
    email VARCHAR(100) COMMENT '邮箱',
    status TINYINT DEFAULT 1 COMMENT '状态：0-禁用，1-正常',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_username (username)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

### 10.5 创建用户角色关联表
```sql
CREATE TABLE IF NOT EXISTS tb_user_role (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'ID',
    user_id INT NOT NULL COMMENT '用户ID',
    role_id INT NOT NULL COMMENT '角色ID',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    FOREIGN KEY (user_id) REFERENCES tb_user(id) ON DELETE CASCADE,
    FOREIGN KEY (role_id) REFERENCES tb_role(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_role (user_id, role_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户角色关联表';
```

### 10.6 创建小区表
```sql
CREATE TABLE IF NOT EXISTS tb_community (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '小区ID',
    name VARCHAR(100) NOT NULL COMMENT '小区名称',
    address VARCHAR(200) COMMENT '小区地址',
    developer VARCHAR(100) COMMENT '开发商',
    property_company VARCHAR(100) COMMENT '物业公司',
    build_year INT COMMENT '建成年份',
    total_buildings INT COMMENT '总楼栋数',
    total_houses INT COMMENT '总户数',
    description TEXT COMMENT '小区描述',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_community_name (name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='小区表';
```

### 10.7 创建楼栋表
```sql
CREATE TABLE IF NOT EXISTS tb_building (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '楼栋ID',
    community_id INT NOT NULL COMMENT '小区ID',
    building_no VARCHAR(20) NOT NULL COMMENT '楼栋编号',
    total_floors INT COMMENT '总楼层',
    unit_count INT COMMENT '单元数',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (community_id) REFERENCES tb_community(id) ON DELETE CASCADE,
    UNIQUE KEY uk_building_no (community_id, building_no)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='楼栋表';
```

### 10.8 创建房间表
```sql
CREATE TABLE IF NOT EXISTS tb_room (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '房间ID',
    building_id INT NOT NULL COMMENT '楼栋ID',
    unit_no VARCHAR(10) NOT NULL COMMENT '单元号',
    floor_no INT NOT NULL COMMENT '楼层号',
    room_no VARCHAR(10) NOT NULL COMMENT '房间号',
    area DECIMAL(10,2) COMMENT '建筑面积',
    room_type VARCHAR(20) COMMENT '户型',
    owner_id INT COMMENT '业主ID',
    status TINYINT DEFAULT 1 COMMENT '状态：0-未售出，1-已售出，2-出租',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (building_id) REFERENCES tb_building(id) ON DELETE CASCADE,
    FOREIGN KEY (owner_id) REFERENCES tb_user(id) ON DELETE SET NULL,
    UNIQUE KEY uk_room_no (building_id, unit_no, floor_no, room_no)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='房间表';
```

### 10.9 创建报修表
```sql
CREATE TABLE IF NOT EXISTS tb_repair (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '报修ID',
    room_id INT NOT NULL COMMENT '房间ID',
    user_id INT NOT NULL COMMENT '报修人ID',
    repair_type VARCHAR(50) NOT NULL COMMENT '报修类型',
    description TEXT COMMENT '问题描述',
    status TINYINT DEFAULT 0 COMMENT '状态：0-待处理，1-处理中，2-已完成，3-已取消',
    handler_id INT COMMENT '处理人ID',
    handle_time DATETIME COMMENT '处理时间',
    handle_notes TEXT COMMENT '处理备注',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (room_id) REFERENCES tb_room(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES tb_user(id) ON DELETE CASCADE,
    FOREIGN KEY (handler_id) REFERENCES tb_user(id) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='报修表';
```

### 10.10 创建费用类型表
```sql
CREATE TABLE IF NOT EXISTS tb_fee_type (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '费用类型ID',
    name VARCHAR(50) NOT NULL COMMENT '费用名称',
    description VARCHAR(200) COMMENT '费用描述',
    unit_price DECIMAL(10,2) COMMENT '单价',
    unit VARCHAR(20) COMMENT '单位',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_fee_name (name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='费用类型表';
```

### 10.11 创建缴费记录表
```sql
CREATE TABLE IF NOT EXISTS tb_payment (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '缴费ID',
    room_id INT NOT NULL COMMENT '房间ID',
    user_id INT NOT NULL COMMENT '缴费人ID',
    fee_type_id INT NOT NULL COMMENT '费用类型ID',
    amount DECIMAL(10,2) NOT NULL COMMENT '缴费金额',
    payment_no VARCHAR(50) NOT NULL COMMENT '缴费单号',
    payment_time DATETIME COMMENT '缴费时间',
    payment_method VARCHAR(20) COMMENT '缴费方式',
    status TINYINT DEFAULT 0 COMMENT '状态：0-未缴费，1-已缴费，2-已取消',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (room_id) REFERENCES tb_room(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES tb_user(id) ON DELETE CASCADE,
    FOREIGN KEY (fee_type_id) REFERENCES tb_fee_type(id) ON DELETE CASCADE,
    UNIQUE KEY uk_payment_no (payment_no)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='缴费记录表';
```

### 10.12 创建公告表
```sql
CREATE TABLE IF NOT EXISTS tb_notice (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '公告ID',
    title VARCHAR(200) NOT NULL COMMENT '公告标题',
    content TEXT NOT NULL COMMENT '公告内容',
    publisher_id INT NOT NULL COMMENT '发布人ID',
    community_id INT COMMENT '所属小区ID，null表示全局公告',
    is_top TINYINT DEFAULT 0 COMMENT '是否置顶：0-否，1-是',
    status TINYINT DEFAULT 1 COMMENT '状态：0-草稿，1-发布，2-撤回',
    publish_time DATETIME COMMENT '发布时间',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (publisher_id) REFERENCES tb_user(id) ON DELETE CASCADE,
    FOREIGN KEY (community_id) REFERENCES tb_community(id) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='公告表';
```

### 10.13 初始化角色数据
```sql
INSERT INTO tb_role (role_name, role_desc) VALUES 
('admin', '系统管理员'),
('property_manager', '物业管理员'),
('owner', '业主');
```

### 10.14 初始化用户数据（密码：123456，已加密）
```sql
INSERT INTO tb_user (username, password, real_name, phone, email, status) VALUES 
('admin', '$2a$10$G0e6bZ5y5mXl6Y5D5h5j5u5i5k5l5m5n5o5p5q5r5s5t5u5v5w5x5y5z', '系统管理员', '13800138000', 'admin@example.com', 1),
('manager1', '$2a$10$G0e6bZ5y5mXl6Y5D5h5j5u5i5k5l5m5n5o5p5q5r5s5t5u5v5w5x5y5z', '物业经理', '13800138001', 'manager1@example.com', 1),
('owner1', '$2a$10$G0e6bZ5y5mXl6Y5D5h5j5u5i5k5l5m5n5o5p5q5r5s5t5u5v5w5x5y5z', '张三', '13800138002', 'owner1@example.com', 1),
('owner2', '$2a$10$G0e6bZ5y5mXl6Y5D5h5j5u5i5k5l5m5n5o5p5q5r5s5t5u5v5w5x5y5z', '李四', '13800138003', 'owner2@example.com', 1);
```

### 10.15 初始化用户角色关联数据
```sql
INSERT INTO tb_user_role (user_id, role_id) VALUES 
(1, 1),  -- admin拥有管理员角色
(2, 2),  -- manager1拥有物业管理员角色
(3, 3),  -- owner1拥有业主角色
(4, 3);  -- owner2拥有业主角色
```

### 10.16 初始化小区数据
```sql
INSERT INTO tb_community (name, address, developer, property_company, build_year, total_buildings, total_houses, description) VALUES 
('阳光花园', '北京市海淀区阳光路88号', '阳光地产', '智慧物业有限公司', 2015, 10, 500, '阳光花园小区环境优美，配套设施齐全'),
('幸福家园', '上海市浦东新区幸福路66号', '幸福地产', '智慧物业有限公司', 2018, 8, 320, '幸福家园是现代化精品小区');
```

### 10.17 初始化楼栋数据
```sql
INSERT INTO tb_building (community_id, building_no, total_floors, unit_count) VALUES 
(1, '1号楼', 18, 2),
(1, '2号楼', 18, 2),
(2, '1号楼', 24, 3),
(2, '2号楼', 24, 3);
```

### 10.18 初始化房间数据
```sql
INSERT INTO tb_room (building_id, unit_no, floor_no, room_no, area, room_type, owner_id, status) VALUES 
(1, '1单元', 5, '101', 89.50, '两室一厅', 3, 1),
(1, '1单元', 5, '102', 95.30, '三室一厅', NULL, 0),
(1, '2单元', 8, '201', 78.80, '两室一厅', NULL, 0),
(2, '1单元', 12, '101', 110.20, '三室两厅', 4, 1),
(2, '2单元', 6, '202', 92.50, '两室两厅', NULL, 0);
```

### 10.19 初始化费用类型数据
```sql
INSERT INTO tb_fee_type (name, description, unit_price, unit) VALUES 
('物业费', '物业管理服务费', 1.80, '元/平方米/月'),
('水费', '居民用水费用', 5.00, '元/吨'),
('电费', '居民用电费用', 0.58, '元/度'),
('燃气费', '居民燃气费用', 2.63, '元/立方米'),
('停车费', '小区停车费用', 150.00, '元/月');
```

### 10.20 初始化报修数据
```sql
INSERT INTO tb_repair (room_id, user_id, repair_type, description, status, handler_id, handle_time, handle_notes) VALUES 
(1, 3, '水电维修', '厨房水龙头漏水', 2, 2, '2023-06-15 14:30:00', '已更换新的水龙头'),
(4, 4, '家电维修', '空调不制冷', 1, 2, NULL, NULL),
(1, 3, '房屋维修', '墙壁出现裂缝', 0, NULL, NULL, NULL);
```

### 10.21 初始化缴费记录数据
```sql
INSERT INTO tb_payment (room_id, user_id, fee_type_id, amount, payment_no, payment_time, payment_method, status) VALUES 
(1, 3, 1, 161.10, '20230601001', '2023-06-01 09:30:00', '微信支付', 1),
(1, 3, 2, 85.50, '20230605001', '2023-06-05 15:20:00', '支付宝', 1),
(4, 4, 1, 198.36, '20230601002', NULL, NULL, 0),
(4, 4, 3, 120.50, '20230603001', '2023-06-03 10:15:00', '银行卡', 1);
```

### 10.22 初始化公告数据
```sql
INSERT INTO tb_notice (title, content, publisher_id, community_id, is_top, status, publish_time) VALUES 
('小区停电通知', '因线路检修，本小区将于2023年6月20日上午8:00-12:00停电，请各位业主提前做好准备。', 2, 1, 1, 1, '2023-06-10 08:30:00'),
('物业费缴费通知', '2023年第二季度物业费开始缴纳，请各位业主及时缴纳。', 2, NULL, 1, 1, '2023-06-01 09:00:00'),
('小区绿化改造通知', '本小区将于7月份进行绿化改造，期间可能会对部分区域通行造成影响，敬请谅解。', 2, 2, 0, 1, '2023-06-12 14:00:00');
```

## 11. 安全建议

为确保系统安全，接口设计和实现应遵循以下安全建议：

### 11.1 认证与授权
- 所有接口必须通过JWT Token进行认证
- 实施基于角色的访问控制（RBAC）
- 敏感操作需进行二次验证

### 11.2 数据安全
- 敏感数据传输必须使用HTTPS协议
- 密码等敏感信息需进行加密存储
- 避免在日志中记录敏感信息

### 11.3 输入验证
- 对所有输入参数进行严格验证
- 防止SQL注入、XSS等常见攻击
- 限制文件上传类型和大小

### 11.4 安全监控
- 记录所有接口访问日志
- 实施异常访问检测机制
- 定期进行安全审计

## 12. 性能优化建议

为确保系统高性能运行，建议遵循以下性能优化原则：

### 12.1 数据库优化
- 合理设计数据库索引
- 避免N+1查询问题
- 使用分页查询大数据集

### 12.2 接口优化
- 实施合理的缓存策略
- 减少不必要的数据传输
- 合并多个接口调用

### 12.3 代码优化
- 避免重复计算和查询
- 使用连接池管理数据库连接
- 实施异步处理耗时操作
